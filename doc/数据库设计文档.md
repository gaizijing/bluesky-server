# ä½ç©ºæ°”è±¡é£è¡Œä¿éšœæœåŠ¡ç³»ç»Ÿ - å®Œæ•´æ•°æ®åº“è®¾è®¡æ–‡æ¡£

> **æ•°æ®åº“**: PostgreSQL 14+  
> **ORMæ¡†æ¶**: MyBatis-Plus  
> **å­—ç¬¦é›†**: UTF-8  
> **æ—¶åŒº**: Asia/Shanghai

---

## ğŸ“‹ ç›®å½•

- [1. æ•°æ®åº“æ¦‚è§ˆ](#1-æ•°æ®åº“æ¦‚è§ˆ)
- [2. æ ¸å¿ƒä¸šåŠ¡è¡¨](#2-æ ¸å¿ƒä¸šåŠ¡è¡¨)
- [3. æ°”è±¡æ•°æ®è¡¨](#3-æ°”è±¡æ•°æ®è¡¨)
- [4. åˆ†æé¢„è­¦è¡¨](#4-åˆ†æé¢„è­¦è¡¨)
- [5. è®¾å¤‡ç®¡ç†è¡¨](#5-è®¾å¤‡ç®¡ç†è¡¨)
- [6. ç³»ç»Ÿç®¡ç†è¡¨](#6-ç³»ç»Ÿç®¡ç†è¡¨)
- [7. ç´¢å¼•è®¾è®¡](#7-ç´¢å¼•è®¾è®¡)
- [8. åˆ†åŒºç­–ç•¥](#8-åˆ†åŒºç­–ç•¥)
- [9. æ•°æ®ä¿ç•™ç­–ç•¥](#9-æ•°æ®ä¿ç•™ç­–ç•¥)

---

## 1. æ•°æ®åº“æ¦‚è§ˆ

### 1.1 è¡¨ç»“æ„æ€»è§ˆ

| åºå· | è¡¨å | ä¸­æ–‡å | è¯´æ˜ | æ•°æ®é‡çº§ |
|-----|------|-------|------|---------|
| 1 | users | ç”¨æˆ·è¡¨ | ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ | å° |
| 2 | roles | è§’è‰²è¡¨ | ç”¨æˆ·è§’è‰²å®šä¹‰ | å° |
| 3 | permissions | æƒé™è¡¨ | æƒé™å®šä¹‰ | å° |
| 4 | user_roles | ç”¨æˆ·è§’è‰²å…³è”è¡¨ | å¤šå¯¹å¤šå…³ç³» | å° |
| 5 | role_permissions | è§’è‰²æƒé™å…³è”è¡¨ | å¤šå¯¹å¤šå…³ç³» | å° |
| 6 | monitoring_points | é‡ç‚¹å…³æ³¨åŒºåŸŸè¡¨ | ç›‘æµ‹ç‚¹ä½ä¿¡æ¯ | ä¸­ |
| 7 | monitoring_point_grids | é‡ç‚¹å…³æ³¨åŒºåŸŸç½‘æ ¼è¡¨ | ç½‘æ ¼å…³è”å…³ç³» | ä¸­ |
| 8 | user_selected_points | ç”¨æˆ·é€‰ä¸­é‡ç‚¹å…³æ³¨åŒºåŸŸè¡¨ | ç”¨æˆ·é€‰æ‹©è®°å½• | å° |
| 9 | weather_realtime | å®æ—¶æ°”è±¡æ•°æ®è¡¨ | å½“å‰æ°”è±¡æ•°æ® | å¤§(åˆ†åŒº) |
| 10 | weather_forecast | æ°”è±¡é¢„æŠ¥æ•°æ®è¡¨ | é¢„æŠ¥æ•°æ® | å¤§(åˆ†åŒº) |
| 11 | wind_trend | é£å‘è¶‹åŠ¿æ•°æ®è¡¨ | é£é€Ÿé£å‘è¶‹åŠ¿ | å¤§(åˆ†åŒº) |
| 12 | wind_field | é£åœºæ•°æ®è¡¨ | 3Dé£åœºç²’å­æ•°æ® | å¤§(åˆ†åŒº) |
| 13 | vertical_profile | å‚ç›´å‰–é¢æ•°æ®è¡¨ | ä¸åŒé«˜åº¦å±‚æ•°æ® | å¤§(åˆ†åŒº) |
| 14 | core_indicators | æ ¸å¿ƒæ°”è±¡è¦ç´ è¡¨ | æ ¸å¿ƒæŒ‡æ ‡ç›‘æµ‹ | å¤§(åˆ†åŒº) |
| 15 | microscale_weather | å¾®å°ºåº¦å¤©æ°”æ•°æ®è¡¨ | ç½‘æ ¼åŒ–ç²¾ç»†æ•°æ® | å¤§(åˆ†åŒº) |
| 16 | microscale_warnings | å¾®å°ºåº¦é¢„è­¦è¡¨ | å®æ—¶å¾®å°ºåº¦é¢„è­¦ | ä¸­ |
| 17 | suitability_analysis | é€‚é£åˆ†ææ•°æ®è¡¨ | é€‚é£çŠ¶æ€åˆ†æ | å¤§(åˆ†åŒº) |
| 18 | risk_warnings | é£é™©é¢„è­¦è¡¨ | é£é™©é¢„è­¦è®°å½• | ä¸­ |
| 19 | flight_tasks | é£è¡Œä»»åŠ¡è¡¨ | é£è¡Œä»»åŠ¡ä¿¡æ¯ | ä¸­ |
| 20 | aircraft_models | é£è¡Œå™¨å‹å·è¡¨ | é£è¡Œå™¨åŸºç¡€ä¿¡æ¯ | å° |
| 21 | aircraft_limits | é£è¡Œå™¨é™åˆ¶è¡¨ | æ°”è±¡é™åˆ¶å‚æ•° | å° |
| 22 | aircraft_adapt_log | é£è¡Œå™¨é€‚é…æ—¥å¿—è¡¨ | é€‚é…åˆ†æè®°å½• | å¤§(åˆ†åŒº) |
| 23 | monitoring_devices | ç›‘æµ‹è®¾å¤‡è¡¨ | è®¾å¤‡åŸºç¡€ä¿¡æ¯ | å° |
| 24 | device_calibration | è®¾å¤‡æ ¡å‡†è®°å½•è¡¨ | æ ¡å‡†å†å² | ä¸­ |
| 25 | device_faults | è®¾å¤‡æ•…éšœè®°å½•è¡¨ | æ•…éšœç»´ä¿®è®°å½• | ä¸­ |
| 26 | system_logs | ç³»ç»Ÿæ—¥å¿—è¡¨ | æ“ä½œæ—¥å¿— | å¤§(åˆ†åŒº) |
| 27 | data_quality_log | æ•°æ®è´¨é‡æ—¥å¿—è¡¨ | æ•°æ®è´¨é‡ç›‘æ§ | å¤§(åˆ†åŒº) |

---

## 2. æ ¸å¿ƒä¸šåŠ¡è¡¨

### 2.1 ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    id VARCHAR(50) PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL COMMENT 'åŠ å¯†åçš„å¯†ç ',
    name VARCHAR(100) COMMENT 'çœŸå®å§“å',
    email VARCHAR(100),
    phone VARCHAR(20),
    status VARCHAR(20) DEFAULT 'active' COMMENT 'active/inactive/locked',
    last_login_time TIMESTAMP,
    login_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    updated_by VARCHAR(50)
);

COMMENT ON TABLE users IS 'ç”¨æˆ·è¡¨';
COMMENT ON COLUMN users.id IS 'ç”¨æˆ·å”¯ä¸€æ ‡è¯†';
COMMENT ON COLUMN users.username IS 'ç™»å½•ç”¨æˆ·å';
COMMENT ON COLUMN users.password IS 'åŠ å¯†å¯†ç (BCrypt)';
COMMENT ON COLUMN users.status IS 'ç”¨æˆ·çŠ¶æ€: active-æ¿€æ´», inactive-åœç”¨, locked-é”å®š';
```

### 2.2 è§’è‰²è¡¨ (roles)

```sql
CREATE TABLE roles (
    id VARCHAR(50) PRIMARY KEY,
    role_code VARCHAR(50) NOT NULL UNIQUE COMMENT 'è§’è‰²ä»£ç ',
    role_name VARCHAR(100) NOT NULL COMMENT 'è§’è‰²åç§°',
    description TEXT,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE roles IS 'è§’è‰²è¡¨';
```

### 2.3 æƒé™è¡¨ (permissions)

```sql
CREATE TABLE permissions (
    id VARCHAR(50) PRIMARY KEY,
    permission_code VARCHAR(100) NOT NULL UNIQUE COMMENT 'æƒé™ä»£ç ',
    permission_name VARCHAR(100) NOT NULL COMMENT 'æƒé™åç§°',
    resource_type VARCHAR(50) COMMENT 'èµ„æºç±»å‹: menu/button/api',
    resource_path VARCHAR(200) COMMENT 'èµ„æºè·¯å¾„',
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE permissions IS 'æƒé™è¡¨';
```

### 2.4 ç”¨æˆ·è§’è‰²å…³è”è¡¨ (user_roles)

```sql
CREATE TABLE user_roles (
    id BIGSERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    role_id VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    UNIQUE(user_id, role_id)
);

COMMENT ON TABLE user_roles IS 'ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

### 2.5 è§’è‰²æƒé™å…³è”è¡¨ (role_permissions)

```sql
CREATE TABLE role_permissions (
    id BIGSERIAL PRIMARY KEY,
    role_id VARCHAR(50) NOT NULL,
    permission_id VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,
    UNIQUE(role_id, permission_id)
);

COMMENT ON TABLE role_permissions IS 'è§’è‰²æƒé™å…³è”è¡¨';
```

### 2.6 é‡ç‚¹å…³æ³¨åŒºåŸŸè¡¨ (monitoring_points)

```sql
CREATE TABLE monitoring_points (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(100) NOT NULL COMMENT 'é‡ç‚¹å…³æ³¨åŒºåŸŸåç§°',
    type VARCHAR(20) NOT NULL COMMENT 'takeoff-èµ·é™ç‚¹, operation-ä½œä¸šç‚¹',
    location VARCHAR(200) COMMENT 'ä½ç½®æè¿°',
    longitude DECIMAL(10, 6) NOT NULL COMMENT 'ä¸­å¿ƒç»åº¦',
    latitude DECIMAL(10, 6) NOT NULL COMMENT 'ä¸­å¿ƒçº¬åº¦',
    bbox_min_lng DECIMAL(10, 6) COMMENT 'è¾¹ç•Œæ¡†æœ€å°ç»åº¦',
    bbox_min_lat DECIMAL(10, 6) COMMENT 'è¾¹ç•Œæ¡†æœ€å°çº¬åº¦',
    bbox_max_lng DECIMAL(10, 6) COMMENT 'è¾¹ç•Œæ¡†æœ€å¤§ç»åº¦',
    bbox_max_lat DECIMAL(10, 6) COMMENT 'è¾¹ç•Œæ¡†æœ€å¤§çº¬åº¦',
    altitude DECIMAL(8, 2) COMMENT 'æµ·æ‹”é«˜åº¦(ç±³)',
    status VARCHAR(20) DEFAULT 'available' COMMENT 'available/warning/unavailable',
    warning_reason VARCHAR(500) COMMENT 'è­¦å‘ŠåŸå› ',
    last_update BIGINT COMMENT 'æœ€åæ›´æ–°æ—¶é—´æˆ³(æ¯«ç§’)',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    updated_by VARCHAR(50)
);

COMMENT ON TABLE monitoring_points IS 'é‡ç‚¹å…³æ³¨åŒºåŸŸè¡¨';
CREATE INDEX idx_monitoring_points_status ON monitoring_points(status);
CREATE INDEX idx_monitoring_points_type ON monitoring_points(type);
CREATE INDEX idx_monitoring_points_location ON monitoring_points USING GIST(
    point(longitude, latitude)
);
```

### 2.7 é‡ç‚¹å…³æ³¨åŒºåŸŸç½‘æ ¼å…³è”è¡¨ (monitoring_point_grids)

```sql
CREATE TABLE monitoring_point_grids (
    id BIGSERIAL PRIMARY KEY,
    point_id VARCHAR(50) NOT NULL,
    grid_id VARCHAR(50) NOT NULL COMMENT 'ç½‘æ ¼ID,å¦‚: BD_120.38_36.06',
    grid_lng DECIMAL(10, 6),
    grid_lat DECIMAL(10, 6),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id) ON DELETE CASCADE,
    UNIQUE(point_id, grid_id)
);

COMMENT ON TABLE monitoring_point_grids IS 'é‡ç‚¹å…³æ³¨åŒºåŸŸç½‘æ ¼å…³è”è¡¨';
CREATE INDEX idx_point_grids_point_id ON monitoring_point_grids(point_id);
CREATE INDEX idx_point_grids_grid_id ON monitoring_point_grids(grid_id);
```

### 2.8 ç”¨æˆ·é€‰ä¸­é‡ç‚¹å…³æ³¨åŒºåŸŸè¡¨ (user_selected_points)

```sql
CREATE TABLE user_selected_points (
    id BIGSERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    point_id VARCHAR(50) NOT NULL,
    selected_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    session_id VARCHAR(100) COMMENT 'ä¼šè¯ID',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id) ON DELETE CASCADE
);

COMMENT ON TABLE user_selected_points IS 'ç”¨æˆ·é€‰ä¸­é‡ç‚¹å…³æ³¨åŒºåŸŸè®°å½•è¡¨';
CREATE INDEX idx_user_selected_user_id ON user_selected_points(user_id);
CREATE INDEX idx_user_selected_point_id ON user_selected_points(point_id);
CREATE INDEX idx_user_selected_time ON user_selected_points(selected_time DESC);
```

---

## 3. æ°”è±¡æ•°æ®è¡¨

### 3.1 å®æ—¶æ°”è±¡æ•°æ®è¡¨ (weather_realtime)

```sql
CREATE TABLE weather_realtime (
    id BIGSERIAL,
    point_id VARCHAR(50) NOT NULL,
    obs_time TIMESTAMP NOT NULL COMMENT 'è§‚æµ‹æ—¶é—´',
    temp DECIMAL(5, 2) COMMENT 'æ¸©åº¦(â„ƒ)',
    feels_like DECIMAL(5, 2) COMMENT 'ä½“æ„Ÿæ¸©åº¦(â„ƒ)',
    icon VARCHAR(20) COMMENT 'å¤©æ°”å›¾æ ‡ä»£ç ',
    text VARCHAR(50) COMMENT 'å¤©æ°”çŠ¶å†µæ–‡å­—',
    wind_360 INTEGER COMMENT 'é£å‘360åº¦',
    wind_dir VARCHAR(20) COMMENT 'é£å‘æ–‡å­—',
    wind_scale VARCHAR(10) COMMENT 'é£åŠ›ç­‰çº§',
    wind_speed DECIMAL(5, 2) COMMENT 'é£é€Ÿ(km/h)',
    humidity INTEGER COMMENT 'ç›¸å¯¹æ¹¿åº¦(%)',
    precip DECIMAL(5, 2) COMMENT 'é™æ°´é‡(mm)',
    pressure DECIMAL(7, 2) COMMENT 'å¤§æ°”å‹å¼º(hPa)',
    vis DECIMAL(5, 2) COMMENT 'èƒ½è§åº¦(km)',
    cloud INTEGER COMMENT 'äº‘é‡(%)',
    dew DECIMAL(5, 2) COMMENT 'éœ²ç‚¹æ¸©åº¦(â„ƒ)',
    wind_shear_level VARCHAR(20) COMMENT 'é£åˆ‡å˜ç­‰çº§: low/medium/high',
    stability_index VARCHAR(10) COMMENT 'ç¨³å®šåº¦æŒ‡æ•°: S/A/B/C',
    data_source VARCHAR(50) COMMENT 'æ•°æ®æ¥æº',
    data_quality INTEGER DEFAULT 100 COMMENT 'æ•°æ®è´¨é‡åˆ†æ•°(0-100)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id),
    PRIMARY KEY (id, obs_time)
) PARTITION BY RANGE (obs_time);

COMMENT ON TABLE weather_realtime IS 'å®æ—¶æ°”è±¡æ•°æ®è¡¨(æŒ‰æ—¶é—´åˆ†åŒº)';

-- åˆ›å»ºåˆ†åŒº(ç¤ºä¾‹:æŒ‰æœˆåˆ†åŒº)
CREATE TABLE weather_realtime_2025_11 PARTITION OF weather_realtime
    FOR VALUES FROM ('2025-11-01') TO ('2025-12-01');
CREATE TABLE weather_realtime_2025_12 PARTITION OF weather_realtime
    FOR VALUES FROM ('2025-12-01') TO ('2026-01-01');
```

### 3.2 æ°”è±¡é¢„æŠ¥æ•°æ®è¡¨ (weather_forecast)

```sql
CREATE TABLE weather_forecast (
    id BIGSERIAL,
    point_id VARCHAR(50) NOT NULL,
    forecast_time TIMESTAMP NOT NULL COMMENT 'é¢„æŠ¥æ—¶é—´',
    issue_time TIMESTAMP NOT NULL COMMENT 'å‘å¸ƒæ—¶é—´',
    forecast_hours INTEGER COMMENT 'é¢„æŠ¥æ—¶é•¿(å°æ—¶)',
    temp DECIMAL(5, 2),
    humidity INTEGER,
    wind_speed DECIMAL(5, 2),
    wind_dir INTEGER,
    precip DECIMAL(5, 2),
    visibility DECIMAL(5, 2),
    cloud_base INTEGER COMMENT 'äº‘åº•é«˜åº¦(ç±³)',
    forecast_model VARCHAR(50) COMMENT 'é¢„æŠ¥æ¨¡å‹',
    confidence DECIMAL(5, 2) COMMENT 'ç½®ä¿¡åº¦(0-100)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id),
    PRIMARY KEY (id, forecast_time)
) PARTITION BY RANGE (forecast_time);

COMMENT ON TABLE weather_forecast IS 'æ°”è±¡é¢„æŠ¥æ•°æ®è¡¨(æŒ‰é¢„æŠ¥æ—¶é—´åˆ†åŒº)';
```

### 3.3 é£å‘è¶‹åŠ¿æ•°æ®è¡¨ (wind_trend)

```sql
CREATE TABLE wind_trend (
    id BIGSERIAL,
    point_id VARCHAR(50) NOT NULL,
    data_time TIMESTAMP NOT NULL COMMENT 'æ•°æ®æ—¶é—´',
    time_label VARCHAR(10) COMMENT 'æ—¶é—´æ ‡ç­¾(HH:mm)',
    wind_speed DECIMAL(5, 2) COMMENT 'é£é€Ÿ(m/s)',
    wind_dir INTEGER COMMENT 'é£å‘(åº¦)',
    upper_limit DECIMAL(5, 2) COMMENT 'é£é€Ÿä¸Šé™(m/s)',
    lower_limit DECIMAL(5, 2) COMMENT 'é£é€Ÿä¸‹é™(m/s)',
    deviation DECIMAL(5, 2) COMMENT 'åå·®å€¼(m/s)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id),
    PRIMARY KEY (id, data_time)
) PARTITION BY RANGE (data_time);

COMMENT ON TABLE wind_trend IS 'é£å‘è¶‹åŠ¿æ•°æ®è¡¨';
```

### 3.4 é£åœºæ•°æ®è¡¨ (wind_field)

```sql
CREATE TABLE wind_field (
    id BIGSERIAL,
    data_time TIMESTAMP NOT NULL,
    height INTEGER NOT NULL COMMENT 'é«˜åº¦(ç±³)',
    longitude DECIMAL(10, 6) NOT NULL,
    latitude DECIMAL(10, 6) NOT NULL,
    u_component DECIMAL(6, 3) COMMENT 'ä¸œè¥¿æ–¹å‘é£é€Ÿåˆ†é‡(m/s)',
    v_component DECIMAL(6, 3) COMMENT 'å—åŒ—æ–¹å‘é£é€Ÿåˆ†é‡(m/s)',
    speed DECIMAL(6, 3) COMMENT 'é£é€Ÿ(m/s)',
    direction INTEGER COMMENT 'é£å‘(åº¦)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, data_time)
) PARTITION BY RANGE (data_time);

COMMENT ON TABLE wind_field IS '3Dé£åœºæ•°æ®è¡¨(ç”¨äºå¯è§†åŒ–)';
```

### 3.5 å‚ç›´å‰–é¢æ•°æ®è¡¨ (vertical_profile)

```sql
CREATE TABLE vertical_profile (
    id BIGSERIAL,
    point_id VARCHAR(50) NOT NULL,
    data_time TIMESTAMP NOT NULL,
    height INTEGER NOT NULL COMMENT 'é«˜åº¦(ç±³)',
    wind_speed DECIMAL(5, 2) COMMENT 'é£é€Ÿ(m/s)',
    temperature DECIMAL(5, 2) COMMENT 'æ¸©åº¦(â„ƒ)',
    humidity INTEGER COMMENT 'æ¹¿åº¦(%)',
    visibility DECIMAL(5, 2) COMMENT 'èƒ½è§åº¦(km)',
    pressure DECIMAL(7, 2) COMMENT 'æ°”å‹(hPa)',
    turbulence_level VARCHAR(20) COMMENT 'æ¹æµç­‰çº§',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id),
    PRIMARY KEY (id, data_time)
) PARTITION BY RANGE (data_time);

COMMENT ON TABLE vertical_profile IS 'å‚ç›´å‰–é¢æ•°æ®è¡¨(ä¸åŒé«˜åº¦å±‚)';
CREATE INDEX idx_vertical_profile_point_height ON vertical_profile(point_id, height, data_time);
```

### 3.6 æ ¸å¿ƒæ°”è±¡è¦ç´ è¡¨ (core_indicators)

```sql
CREATE TABLE core_indicators (
    id BIGSERIAL,
    point_id VARCHAR(50),
    data_time TIMESTAMP NOT NULL,
    indicator_id VARCHAR(50) NOT NULL COMMENT 'è¦ç´ ID: temp/humidity/windSpeedç­‰',
    indicator_name VARCHAR(50) COMMENT 'è¦ç´ åç§°',
    value DECIMAL(10, 2) COMMENT 'å½“å‰å€¼',
    unit VARCHAR(20) COMMENT 'å•ä½',
    precision VARCHAR(50) COMMENT 'ç²¾åº¦è¯´æ˜',
    status VARCHAR(20) COMMENT 'normal/warning/danger',
    threshold_warning DECIMAL(10, 2) COMMENT 'è­¦å‘Šé˜ˆå€¼',
    threshold_danger DECIMAL(10, 2) COMMENT 'å±é™©é˜ˆå€¼',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, data_time)
) PARTITION BY RANGE (data_time);

COMMENT ON TABLE core_indicators IS 'æ ¸å¿ƒæ°”è±¡è¦ç´ ç›‘æµ‹è¡¨';
```

### 3.7 å¾®å°ºåº¦å¤©æ°”æ•°æ®è¡¨ (microscale_weather)

```sql
CREATE TABLE microscale_weather (
    id BIGSERIAL,
    region VARCHAR(100) COMMENT 'åŒºåŸŸåç§°',
    data_time TIMESTAMP NOT NULL,
    grid_size INTEGER COMMENT 'ç½‘æ ¼å¤§å°(ç±³)',
    grid_x DECIMAL(10, 6) COMMENT 'ç½‘æ ¼Xåæ ‡',
    grid_y DECIMAL(10, 6) COMMENT 'ç½‘æ ¼Yåæ ‡',
    risk_level INTEGER COMMENT 'é£é™©ç­‰çº§(0-3)',
    wind_speed DECIMAL(5, 2),
    wind_shear DECIMAL(5, 2),
    turbulence DECIMAL(5, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, data_time)
) PARTITION BY RANGE (data_time);

COMMENT ON TABLE microscale_weather IS 'å¾®å°ºåº¦å¤©æ°”ç½‘æ ¼æ•°æ®è¡¨';
```

---

## 4. åˆ†æé¢„è­¦è¡¨

### 4.1 é€‚é£åˆ†ææ•°æ®è¡¨ (suitability_analysis)

```sql
CREATE TABLE suitability_analysis (
    id BIGSERIAL,
    point_id VARCHAR(50) NOT NULL,
    analysis_time TIMESTAMP NOT NULL COMMENT 'åˆ†ææ—¶é—´',
    time_interval INTEGER COMMENT 'æ—¶é—´é—´éš”(åˆ†é’Ÿ)',
    total_hours INTEGER COMMENT 'é¢„æµ‹æ€»æ—¶é•¿(å°æ—¶)',
    factor VARCHAR(50) NOT NULL COMMENT 'æ°”è±¡å› ç´ : ç»¼åˆ/é£/é£åˆ‡å˜/é¢ ç°¸æŒ‡æ•°ç­‰',
    time_point VARCHAR(50) NOT NULL COMMENT 'æ—¶é—´ç‚¹',
    is_suitable BOOLEAN COMMENT 'æ˜¯å¦é€‚é£',
    abnormal_value VARCHAR(50) COMMENT 'å¼‚å¸¸å€¼',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id),
    PRIMARY KEY (id, analysis_time)
) PARTITION BY RANGE (analysis_time);

COMMENT ON TABLE suitability_analysis IS 'é€‚é£åˆ†ææ•°æ®è¡¨';
CREATE INDEX idx_suitability_point_factor ON suitability_analysis(point_id, factor, analysis_time);
```

### 4.2 é£é™©é¢„è­¦è¡¨ (risk_warnings)

```sql
CREATE TABLE risk_warnings (
    id VARCHAR(50) PRIMARY KEY COMMENT 'é¢„è­¦ID,æ ¼å¼: RW+æ—¥æœŸ+åºå·',
    point_id VARCHAR(50),
    level VARCHAR(20) NOT NULL COMMENT 'danger/warning/info',
    type VARCHAR(50) NOT NULL COMMENT 'é¢„è­¦ç±»å‹: å¼ºé£/ä½èƒ½è§åº¦/æ¸©åº¦éª¤é™ç­‰',
    area VARCHAR(200) COMMENT 'å½±å“åŒºåŸŸ',
    start_time TIME COMMENT 'é¢„è­¦å¼€å§‹æ—¶é—´',
    end_time TIME COMMENT 'é¢„è­¦ç»“æŸæ—¶é—´',
    warning_date DATE COMMENT 'é¢„è­¦æ—¥æœŸ',
    detail TEXT COMMENT 'è¯¦ç»†æè¿°',
    suggestion TEXT COMMENT 'å»ºè®®æªæ–½',
    handle_status VARCHAR(20) DEFAULT 'unhandled' COMMENT 'unhandled/handled',
    handler VARCHAR(50) COMMENT 'å¤„ç†äºº',
    handle_time TIMESTAMP COMMENT 'å¤„ç†æ—¶é—´',
    handle_remark TEXT COMMENT 'å¤„ç†å¤‡æ³¨',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id)
);

COMMENT ON TABLE risk_warnings IS 'é£é™©é¢„è­¦è¡¨';
CREATE INDEX idx_risk_warnings_point_id ON risk_warnings(point_id);
CREATE INDEX idx_risk_warnings_level ON risk_warnings(level);
CREATE INDEX idx_risk_warnings_status ON risk_warnings(handle_status);
CREATE INDEX idx_risk_warnings_date ON risk_warnings(warning_date DESC);
CREATE INDEX idx_risk_warnings_created ON risk_warnings(created_at DESC);
```

### 4.3 å¾®å°ºåº¦é¢„è­¦è¡¨ (microscale_warnings)

```sql
CREATE TABLE microscale_warnings (
    id VARCHAR(50) PRIMARY KEY COMMENT 'é¢„è­¦ID,æ ¼å¼: MW+æ—¥æœŸ+åºå·',
    type VARCHAR(50) NOT NULL COMMENT 'é¢„è­¦ç±»å‹: å¼ºæ¹æµ/é£åˆ‡å˜/å±€éƒ¨å¼ºé£',
    level VARCHAR(20) NOT NULL COMMENT 'high/medium/low',
    area VARCHAR(200) COMMENT 'å½±å“åŒºåŸŸ',
    x_min DECIMAL(10, 6),
    x_max DECIMAL(10, 6),
    y_min DECIMAL(10, 6),
    y_max DECIMAL(10, 6),
    start_time TIME,
    end_time TIME,
    warning_date DATE,
    detail TEXT,
    suggestion TEXT,
    handle_status VARCHAR(20) DEFAULT 'unhandled',
    related_task_id VARCHAR(50) COMMENT 'å…³è”é£è¡Œä»»åŠ¡ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE microscale_warnings IS 'å¾®å°ºåº¦å®æ—¶é¢„è­¦è¡¨';
CREATE INDEX idx_microscale_warnings_level ON microscale_warnings(level);
CREATE INDEX idx_microscale_warnings_task ON microscale_warnings(related_task_id);
CREATE INDEX idx_microscale_warnings_date ON microscale_warnings(warning_date DESC);
```

---

## 5. é£è¡Œä»»åŠ¡ä¸é£è¡Œå™¨è¡¨

### 5.1 é£è¡Œä»»åŠ¡è¡¨ (flight_tasks)

```sql
CREATE TABLE flight_tasks (
    task_id VARCHAR(50) PRIMARY KEY COMMENT 'ä»»åŠ¡ID,æ ¼å¼: FT+æ—¥æœŸ+åºå·',
    type VARCHAR(20) NOT NULL COMMENT 'ä»»åŠ¡ç±»å‹: æ•‘æ´/ç‰©æµ/å·¡æ£€/è®­ç»ƒ',
    type_color VARCHAR(20) COMMENT 'ç±»å‹é¢œè‰²ä»£ç ',
    aircraft_id VARCHAR(50) COMMENT 'é£è¡Œå™¨ID',
    aircraft_type VARCHAR(100) COMMENT 'é£è¡Œå™¨å‹å·',
    takeoff VARCHAR(100) COMMENT 'èµ·é£ç‚¹',
    landing VARCHAR(100) COMMENT 'é™è½ç‚¹',
    takeoff_point_id VARCHAR(50) COMMENT 'èµ·é£é‡ç‚¹å…³æ³¨åŒºåŸŸID',
    landing_point_id VARCHAR(50) COMMENT 'é™è½é‡ç‚¹å…³æ³¨åŒºåŸŸID',
    plan_height INTEGER COMMENT 'è®¡åˆ’é£è¡Œé«˜åº¦(ç±³)',
    actual_height INTEGER COMMENT 'å®é™…é£è¡Œé«˜åº¦(ç±³)',
    status VARCHAR(20) DEFAULT 'waiting' COMMENT 'waiting/ongoing/completed/cancelled',
    current_pos VARCHAR(200) COMMENT 'å½“å‰ä½ç½®',
    current_lng DECIMAL(10, 6),
    current_lat DECIMAL(10, 6),
    meteorology_adapt VARCHAR(20) COMMENT 'æ°”è±¡é€‚é…çŠ¶æ€: é€‚é…/ä¸é€‚é…',
    adapt_reason TEXT COMMENT 'é€‚é…åŸå› è¯´æ˜',
    start_time TIME,
    end_time TIME,
    actual_start_time TIMESTAMP,
    actual_end_time TIMESTAMP,
    task_date DATE NOT NULL,
    route_data JSONB COMMENT 'èˆªçº¿æ•°æ®(JSONæ ¼å¼)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    updated_by VARCHAR(50),
    FOREIGN KEY (aircraft_id) REFERENCES aircraft_models(id)
);

COMMENT ON TABLE flight_tasks IS 'é£è¡Œä»»åŠ¡è¡¨';
CREATE INDEX idx_flight_tasks_status ON flight_tasks(status);
CREATE INDEX idx_flight_tasks_date ON flight_tasks(task_date DESC);
CREATE INDEX idx_flight_tasks_type ON flight_tasks(type);
CREATE INDEX idx_flight_tasks_aircraft ON flight_tasks(aircraft_id);
```

### 5.2 é£è¡Œå™¨å‹å·è¡¨ (aircraft_models)

```sql
CREATE TABLE aircraft_models (
    id VARCHAR(50) PRIMARY KEY,
    model_name VARCHAR(100) NOT NULL COMMENT 'å‹å·åç§°',
    category VARCHAR(50) COMMENT 'ç±»åˆ«: ç›´å‡æœº/å›ºå®šç¿¼/å¤šæ—‹ç¿¼/æ— äººæœº',
    manufacturer VARCHAR(100) COMMENT 'åˆ¶é€ å•†',
    max_altitude INTEGER COMMENT 'æœ€å¤§é£è¡Œé«˜åº¦(ç±³)',
    max_speed DECIMAL(6, 2) COMMENT 'æœ€å¤§é€Ÿåº¦(km/h)',
    cruise_speed DECIMAL(6, 2) COMMENT 'å·¡èˆªé€Ÿåº¦(km/h)',
    max_range DECIMAL(8, 2) COMMENT 'æœ€å¤§èˆªç¨‹(km)',
    max_endurance INTEGER COMMENT 'æœ€å¤§ç»­èˆªæ—¶é—´(åˆ†é’Ÿ)',
    max_payload DECIMAL(8, 2) COMMENT 'æœ€å¤§è½½é‡(kg)',
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE aircraft_models IS 'é£è¡Œå™¨å‹å·åŸºç¡€ä¿¡æ¯è¡¨';
```

### 5.3 é£è¡Œå™¨æ°”è±¡é™åˆ¶è¡¨ (aircraft_limits)

```sql
CREATE TABLE aircraft_limits (
    id BIGSERIAL PRIMARY KEY,
    aircraft_id VARCHAR(50) NOT NULL,
    max_wind_speed DECIMAL(5, 2) COMMENT 'æœ€å¤§é£é€Ÿé™åˆ¶(m/s)',
    max_wind_shear DECIMAL(5, 2) COMMENT 'æœ€å¤§é£åˆ‡å˜é™åˆ¶(m/s)',
    min_visibility DECIMAL(5, 2) COMMENT 'æœ€å°èƒ½è§åº¦é™åˆ¶(km)',
    max_precipitation DECIMAL(5, 2) COMMENT 'æœ€å¤§é™æ°´é‡é™åˆ¶(mm)',
    min_cloud_base INTEGER COMMENT 'æœ€å°äº‘åº•é«˜åº¦é™åˆ¶(ç±³)',
    temp_min DECIMAL(5, 2) COMMENT 'æœ€ä½æ¸©åº¦é™åˆ¶(â„ƒ)',
    temp_max DECIMAL(5, 2) COMMENT 'æœ€é«˜æ¸©åº¦é™åˆ¶(â„ƒ)',
    max_humidity INTEGER COMMENT 'æœ€å¤§æ¹¿åº¦é™åˆ¶(%)',
    max_turbulence_level VARCHAR(20) COMMENT 'æœ€å¤§æ¹æµç­‰çº§',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (aircraft_id) REFERENCES aircraft_models(id) ON DELETE CASCADE,
    UNIQUE(aircraft_id)
);

COMMENT ON TABLE aircraft_limits IS 'é£è¡Œå™¨æ°”è±¡é™åˆ¶å‚æ•°è¡¨';
```

### 5.4 é£è¡Œå™¨é€‚é…æ—¥å¿—è¡¨ (aircraft_adapt_log)

```sql
CREATE TABLE aircraft_adapt_log (
    id BIGSERIAL,
    aircraft_id VARCHAR(50) NOT NULL,
    point_id VARCHAR(50),
    check_time TIMESTAMP NOT NULL,
    adapt_result VARCHAR(20) COMMENT 'é€‚é…/ä¸é€‚é…',
    adapt_reason TEXT,
    current_wind_speed DECIMAL(5, 2),
    current_visibility DECIMAL(5, 2),
    current_cloud_base INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (aircraft_id) REFERENCES aircraft_models(id),
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id),
    PRIMARY KEY (id, check_time)
) PARTITION BY RANGE (check_time);

COMMENT ON TABLE aircraft_adapt_log IS 'é£è¡Œå™¨æ°”è±¡é€‚é…æ£€æŸ¥æ—¥å¿—è¡¨';
```

---

## 6. è®¾å¤‡ç®¡ç†è¡¨

### 6.1 ç›‘æµ‹è®¾å¤‡è¡¨ (monitoring_devices)

```sql
CREATE TABLE monitoring_devices (
    id VARCHAR(50) PRIMARY KEY,
    device_name VARCHAR(100) NOT NULL COMMENT 'è®¾å¤‡åç§°',
    device_type VARCHAR(50) COMMENT 'è®¾å¤‡ç±»å‹: è¶…å£°é£é€Ÿä»ª/æµ‹äº‘ä»ª/æ¸©æ¹¿åº¦è®¡ç­‰',
    model VARCHAR(100) COMMENT 'è®¾å¤‡å‹å·',
    manufacturer VARCHAR(100) COMMENT 'åˆ¶é€ å•†',
    point_id VARCHAR(50) COMMENT 'æ‰€å±é‡ç‚¹å…³æ³¨åŒºåŸŸ',
    install_location VARCHAR(200) COMMENT 'å®‰è£…ä½ç½®',
    longitude DECIMAL(10, 6),
    latitude DECIMAL(10, 6),
    altitude DECIMAL(8, 2),
    status VARCHAR(20) DEFAULT 'normal' COMMENT 'normal/fault/maintenance/offline',
    install_date DATE COMMENT 'å®‰è£…æ—¥æœŸ',
    warranty_expire_date DATE COMMENT 'ä¿ä¿®åˆ°æœŸæ—¥æœŸ',
    blockchain_hash VARCHAR(100) COMMENT 'åŒºå—é“¾æº¯æºå“ˆå¸Œ',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (point_id) REFERENCES monitoring_points(id)
);

COMMENT ON TABLE monitoring_devices IS 'ç›‘æµ‹è®¾å¤‡åŸºç¡€ä¿¡æ¯è¡¨';
CREATE INDEX idx_devices_status ON monitoring_devices(status);
CREATE INDEX idx_devices_point ON monitoring_devices(point_id);
CREATE INDEX idx_devices_type ON monitoring_devices(device_type);
```

### 6.2 è®¾å¤‡æ ¡å‡†è®°å½•è¡¨ (device_calibration)

```sql
CREATE TABLE device_calibration (
    id BIGSERIAL PRIMARY KEY,
    device_id VARCHAR(50) NOT NULL,
    calibration_time TIMESTAMP NOT NULL COMMENT 'æ ¡å‡†æ—¶é—´',
    calibration_type VARCHAR(50) COMMENT 'æ ¡å‡†ç±»å‹: å®šæœŸ/æ•…éšœå/ç²¾åº¦å¼‚å¸¸',
    calibrator VARCHAR(50) COMMENT 'æ ¡å‡†äººå‘˜',
    calibration_result VARCHAR(20) COMMENT 'pass/fail',
    before_accuracy VARCHAR(100) COMMENT 'æ ¡å‡†å‰ç²¾åº¦',
    after_accuracy VARCHAR(100) COMMENT 'æ ¡å‡†åç²¾åº¦',
    calibration_certificate VARCHAR(200) COMMENT 'æ ¡å‡†è¯ä¹¦ç¼–å·',
    next_calibration_date DATE COMMENT 'ä¸‹æ¬¡æ ¡å‡†æ—¥æœŸ',
    remark TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (device_id) REFERENCES monitoring_devices(id)
);

COMMENT ON TABLE device_calibration IS 'è®¾å¤‡æ ¡å‡†è®°å½•è¡¨';
CREATE INDEX idx_calibration_device ON device_calibration(device_id);
CREATE INDEX idx_calibration_time ON device_calibration(calibration_time DESC);
```

### 6.3 è®¾å¤‡æ•…éšœè®°å½•è¡¨ (device_faults)

```sql
CREATE TABLE device_faults (
    id BIGSERIAL PRIMARY KEY,
    device_id VARCHAR(50) NOT NULL,
    fault_time TIMESTAMP NOT NULL COMMENT 'æ•…éšœæ—¶é—´',
    fault_type VARCHAR(50) COMMENT 'æ•…éšœç±»å‹',
    fault_reason TEXT COMMENT 'æ•…éšœåŸå› ',
    fault_level VARCHAR(20) COMMENT 'critical/major/minor',
    handler VARCHAR(50) COMMENT 'å¤„ç†äºº',
    repair_status VARCHAR(20) DEFAULT 'pending' COMMENT 'pending/processing/completed',
    repair_start_time TIMESTAMP,
    repair_end_time TIMESTAMP,
    repair_cost DECIMAL(10, 2) COMMENT 'ç»´ä¿®è´¹ç”¨',
    parts_replaced TEXT COMMENT 'æ›´æ¢éƒ¨ä»¶',
    repair_remark TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (device_id) REFERENCES monitoring_devices(id)
);

COMMENT ON TABLE device_faults IS 'è®¾å¤‡æ•…éšœç»´ä¿®è®°å½•è¡¨';
CREATE INDEX idx_faults_device ON device_faults(device_id);
CREATE INDEX idx_faults_status ON device_faults(repair_status);
CREATE INDEX idx_faults_time ON device_faults(fault_time DESC);
```

---

## 7. ç³»ç»Ÿç®¡ç†è¡¨

### 7.1 ç³»ç»Ÿæ—¥å¿—è¡¨ (system_logs)

```sql
CREATE TABLE system_logs (
    id BIGSERIAL,
    log_time TIMESTAMP NOT NULL,
    user_id VARCHAR(50),
    username VARCHAR(50),
    operation VARCHAR(100) COMMENT 'æ“ä½œç±»å‹',
    module VARCHAR(50) COMMENT 'æ¨¡å—',
    method VARCHAR(20) COMMENT 'GET/POST/PUT/DELETE',
    request_url VARCHAR(500),
    request_params TEXT,
    response_status INTEGER,
    response_time INTEGER COMMENT 'å“åº”æ—¶é—´(æ¯«ç§’)',
    ip_address VARCHAR(50),
    user_agent TEXT,
    error_msg TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, log_time)
) PARTITION BY RANGE (log_time);

COMMENT ON TABLE system_logs IS 'ç³»ç»Ÿæ“ä½œæ—¥å¿—è¡¨(æŒ‰æ—¶é—´åˆ†åŒº)';
```

### 7.2 æ•°æ®è´¨é‡æ—¥å¿—è¡¨ (data_quality_log)

```sql
CREATE TABLE data_quality_log (
    id BIGSERIAL,
    check_time TIMESTAMP NOT NULL,
    data_source VARCHAR(50) COMMENT 'æ•°æ®æº',
    data_type VARCHAR(50) COMMENT 'æ•°æ®ç±»å‹',
    total_records INTEGER COMMENT 'æ€»è®°å½•æ•°',
    valid_records INTEGER COMMENT 'æœ‰æ•ˆè®°å½•æ•°',
    invalid_records INTEGER COMMENT 'æ— æ•ˆè®°å½•æ•°',
    quality_score DECIMAL(5, 2) COMMENT 'è´¨é‡åˆ†æ•°(0-100)',
    issues TEXT COMMENT 'è´¨é‡é—®é¢˜æè¿°',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, check_time)
) PARTITION BY RANGE (check_time);

COMMENT ON TABLE data_quality_log IS 'æ•°æ®è´¨é‡ç›‘æ§æ—¥å¿—è¡¨';
```

---

## 8. ç´¢å¼•è®¾è®¡æ±‡æ€»

### 8.1 æ ¸å¿ƒä¸šåŠ¡è¡¨ç´¢å¼•

```sql
-- ç”¨æˆ·è¡¨
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_last_login ON users(last_login_time DESC);

-- é‡ç‚¹å…³æ³¨åŒºåŸŸè¡¨
CREATE INDEX idx_monitoring_points_status ON monitoring_points(status);
CREATE INDEX idx_monitoring_points_type ON monitoring_points(type);
CREATE INDEX idx_monitoring_points_active ON monitoring_points(is_active);

-- é£é™©é¢„è­¦è¡¨
CREATE INDEX idx_risk_warnings_composite ON risk_warnings(point_id, warning_date, level);

-- é£è¡Œä»»åŠ¡è¡¨
CREATE INDEX idx_flight_tasks_composite ON flight_tasks(task_date, status, type);
```

### 8.2 æ°”è±¡æ•°æ®è¡¨ç´¢å¼•

```sql
-- å®æ—¶æ°”è±¡æ•°æ®(åœ¨æ¯ä¸ªåˆ†åŒºä¸Šåˆ›å»º)
CREATE INDEX idx_weather_realtime_point_time ON weather_realtime(point_id, obs_time DESC);
CREATE INDEX idx_weather_realtime_quality ON weather_realtime(data_quality);

-- å‚ç›´å‰–é¢æ•°æ®
CREATE INDEX idx_vertical_profile_composite ON vertical_profile(point_id, data_time, height);

-- é€‚é£åˆ†ææ•°æ®
CREATE INDEX idx_suitability_composite ON suitability_analysis(point_id, analysis_time, factor);
```

---

## 9. åˆ†åŒºç­–ç•¥

### 9.1 æŒ‰æ—¶é—´åˆ†åŒºçš„è¡¨

ä»¥ä¸‹è¡¨å»ºè®®æŒ‰æœˆæˆ–æŒ‰å‘¨åˆ†åŒº,æ ¹æ®æ•°æ®é‡è°ƒæ•´:

| è¡¨å | åˆ†åŒºå­—æ®µ | åˆ†åŒºç­–ç•¥ | ä¿ç•™æœŸé™ |
|-----|---------|---------|---------|
| weather_realtime | obs_time | æŒ‰æœˆ | 6ä¸ªæœˆ |
| weather_forecast | forecast_time | æŒ‰æœˆ | 3ä¸ªæœˆ |
| wind_trend | data_time | æŒ‰æœˆ | 3ä¸ªæœˆ |
| wind_field | data_time | æŒ‰å‘¨ | 1ä¸ªæœˆ |
| vertical_profile | data_time | æŒ‰æœˆ | 3ä¸ªæœˆ |
| core_indicators | data_time | æŒ‰æœˆ | 6ä¸ªæœˆ |
| microscale_weather | data_time | æŒ‰å‘¨ | 1ä¸ªæœˆ |
| suitability_analysis | analysis_time | æŒ‰æœˆ | 3ä¸ªæœˆ |
| aircraft_adapt_log | check_time | æŒ‰æœˆ | 6ä¸ªæœˆ |
| system_logs | log_time | æŒ‰æœˆ | 12ä¸ªæœˆ |
| data_quality_log | check_time | æŒ‰æœˆ | 6ä¸ªæœˆ |

### 9.2 åˆ†åŒºç®¡ç†è„šæœ¬ç¤ºä¾‹

```sql
-- è‡ªåŠ¨åˆ›å»ºæœªæ¥3ä¸ªæœˆçš„åˆ†åŒº(ä»¥weather_realtimeä¸ºä¾‹)
DO $$
DECLARE
    start_date DATE;
    end_date DATE;
    partition_name TEXT;
BEGIN
    FOR i IN 0..2 LOOP
        start_date := DATE_TRUNC('month', CURRENT_DATE + (i || ' month')::INTERVAL);
        end_date := start_date + INTERVAL '1 month';
        partition_name := 'weather_realtime_' || TO_CHAR(start_date, 'YYYY_MM');
        
        EXECUTE format('CREATE TABLE IF NOT EXISTS %I PARTITION OF weather_realtime
                       FOR VALUES FROM (%L) TO (%L)',
                       partition_name, start_date, end_date);
    END LOOP;
END $$;
```

---

## 10. æ•°æ®ä¿ç•™ç­–ç•¥

### 10.1 è‡ªåŠ¨æ¸…ç†ç­–ç•¥

```sql
-- åˆ›å»ºå®šæ—¶ä»»åŠ¡æ¸…ç†è¿‡æœŸæ•°æ®(éœ€è¦pg_cronæ‰©å±•)
-- æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ

-- æ¸…ç†6ä¸ªæœˆå‰çš„å®æ—¶æ°”è±¡æ•°æ®
CREATE EXTENSION IF NOT EXISTS pg_cron;

SELECT cron.schedule('cleanup-weather-realtime', '0 2 * * *', $$
    DELETE FROM weather_realtime 
    WHERE obs_time < CURRENT_DATE - INTERVAL '6 months'
$$);

-- æ¸…ç†12ä¸ªæœˆå‰çš„ç³»ç»Ÿæ—¥å¿—
SELECT cron.schedule('cleanup-system-logs', '0 2 * * *', $$
    DELETE FROM system_logs 
    WHERE log_time < CURRENT_DATE - INTERVAL '12 months'
$$);
```

### 10.2 æ•°æ®å½’æ¡£å»ºè®®

å¯¹äºé‡è¦å†å²æ•°æ®,å»ºè®®å½’æ¡£è€Œéåˆ é™¤:

1. **å®æ—¶æ°”è±¡æ•°æ®**: 6ä¸ªæœˆåå½’æ¡£åˆ°å†å²åº“
2. **é£è¡Œä»»åŠ¡æ•°æ®**: æ°¸ä¹…ä¿ç•™
3. **é£é™©é¢„è­¦æ•°æ®**: æ°¸ä¹…ä¿ç•™
4. **è®¾å¤‡æ•…éšœè®°å½•**: æ°¸ä¹…ä¿ç•™
5. **ç³»ç»Ÿæ—¥å¿—**: 12ä¸ªæœˆåå½’æ¡£

---

## 11. åˆå§‹åŒ–æ•°æ®è„šæœ¬

### 11.1 åˆå§‹åŒ–è§’è‰²å’Œæƒé™

```sql
-- æ’å…¥é»˜è®¤è§’è‰²
INSERT INTO roles (id, role_code, role_name, description) VALUES
('role-admin', 'ADMIN', 'ç³»ç»Ÿç®¡ç†å‘˜', 'æ‹¥æœ‰æ‰€æœ‰æƒé™'),
('role-operator', 'OPERATOR', 'æ“ä½œå‘˜', 'æ—¥å¸¸æ“ä½œæƒé™'),
('role-viewer', 'VIEWER', 'æŸ¥çœ‹è€…', 'åªè¯»æƒé™');

-- æ’å…¥é»˜è®¤æƒé™
INSERT INTO permissions (id, permission_code, permission_name, resource_type) VALUES
('perm-dashboard', 'DASHBOARD_VIEW', 'æŸ¥çœ‹ä»ªè¡¨ç›˜', 'menu'),
('perm-map', 'MAP_VIEW', 'æŸ¥çœ‹åœ°å›¾', 'menu'),
('perm-setting', 'SETTING_MANAGE', 'ç³»ç»Ÿè®¾ç½®', 'menu'),
('perm-user-manage', 'USER_MANAGE', 'ç”¨æˆ·ç®¡ç†', 'menu'),
('perm-point-manage', 'POINT_MANAGE', 'é‡ç‚¹å…³æ³¨åŒºåŸŸç®¡ç†', 'menu'),
('perm-task-manage', 'TASK_MANAGE', 'ä»»åŠ¡ç®¡ç†', 'menu'),
('perm-warning-manage', 'WARNING_MANAGE', 'é¢„è­¦ç®¡ç†', 'menu');

-- åˆ†é…æƒé™ç»™ç®¡ç†å‘˜è§’è‰²
INSERT INTO role_permissions (role_id, permission_id)
SELECT 'role-admin', id FROM permissions;
```

### 11.2 åˆå§‹åŒ–é»˜è®¤ç”¨æˆ·

```sql
-- æ’å…¥é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·(å¯†ç : admin123, éœ€è¦BCryptåŠ å¯†)
INSERT INTO users (id, username, password, name, status) VALUES
('user-admin', 'admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iAt6Z5EH', 'ç³»ç»Ÿç®¡ç†å‘˜', 'active');

-- åˆ†é…ç®¡ç†å‘˜è§’è‰²
INSERT INTO user_roles (user_id, role_id, created_by) VALUES
('user-admin', 'role-admin', 'system');
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-03  
**ç»´æŠ¤è€…**: æ•°æ®åº“è®¾è®¡å›¢é˜Ÿ
